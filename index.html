<html>
	<head>
		<meta charset="UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js">
		</script>
		<script src="js/jogo.js"></script>
		<script src="js/SAT.js"></script>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<body bgcolor="#000000">
		<div class="scene">
			<div class="stars"></div>
			<div class="twinkling"></div>
			<h3 class="titulo">Aperte espaço para mudar a direção</h3><br>
			<h3 class="titulo">e enter para atirar</h3>
			<br>
			<h3 class="pontuacao">Score: <span id="minha-pontuacao-linda">120</span></h3>
			<div class="terradiv">
				<img id="terra" src="./Earth-Free-Download-PNG.png"/>
			</div> 
			<div class="image1">
				<img id="eric" src="https://emoji.slack-edge.com/T0NGK4FPS/eric/8a5698b1bd5ce9be.png"/>
			</div>
		</div>
		<div class="villain template">
			<img src="https://emoji.slack-edge.com/T0NGK4FPS/salles/eefac6cd78a94882.png" />
		</div>
	</body>

	<script>
		window.addEventListener("keydown", change, false);
		window.addEventListener("keyup", shootdetector, false);
	    var $elie = $('.image1');
	    var $earth = $('.terradiv');
	    var degree = 0;
	    var degree2 = 0;
	    var direction = true;
	    var shoots = [];
	    var id = 1;
	    var salesnum = 1;
	    var enemies = [];
	    var score = 0;
	    var multiplier = 1;

	    function change(e){
	    	if(e.keyCode == '32'){
	    		direction = !direction;
	    	} else if(e.keyCode == '13'){
	    		setTimeout(function(){
	    			multiplier = 2*multiplier;
	    		},2000);
	    		setTimeout(function(){
	    			multiplier = 2*multiplier;
	    		},2000);
	    	}
	    }
	    function shootdetector(e){
	    	if (e.keyCode == '13'){
	    		shoot(multiplier);
	    		multiplier = 1;
	    	}
	    }
	    function rotateearth(){
	    	if (degree2 == 360 || degree2 == -360){
	    		degree2 = 0;
	    	}
	    	$earth.css({ WebkitTransform: 'rotate(' + degree2 + 'deg)'});
	    	timer = setTimeout(function() {
	    		degree2 += 0.005;
	    		for (i=0; i<enemies.length; i++){
	    			for (j=0; j<shoots.length; j++){
	    				if (enemies[i].contact(shoots[j])){
	    					enemies[i].collide(shoots[j]);
	    					document.getElementById(shoots[j].div[0].id).remove();
	    					shoots.splice(j,1);
							$(enemies[i].div).find('img').attr("src","https://lh5.googleusercontent.com/-ybsaLXodIAk/V7ND4jj07hI/AAAAAAAAAVU/ivUhWXycGYcdkhtiwYv4pFIMwuWdVX93gCL0B/w80-h100-no/angrysales.png");
	    				}
	    			}
	    		};
	    		for (i=0; i<enemies.length; i++){
	    			enemies[i].move(1/60);
	    			enemies[i].updateUI();
	    		};
	    		for (i=0; i<shoots.length; i++){
	    			shoots[i].move(1/60);
	    			shoots[i].updateUI();
	    		};
	    		for (i=0;i<enemies.length;i++){
					var wd = $('.scene').width();
					var ht = $('.scene').height();
					if ( enemies[i].collided && (enemies[i].position.x < -enemies[i].width || enemies[i].position.x > wd || enemies[i].position.y < -enemies[i].height || enemies[i].position.y > ht )){
						enemies[i].div.hide()
						enemies.splice(i,1);
						score += 20;
						$('#minha-pontuacao-linda').html(score);
					}
				};
	    		rotateearth();
	    	},(1/60));
	    }
	    function rotate(){
	    	if (degree == 360 || degree == -360){
	    		degree = 0;
	    	}
	    	if (degree < 0){
	    		degree = 360 + degree;
	    	}
	       	$elie.css({ WebkitTransform: 'rotate(' + degree + 'deg)'});
			timer = setTimeout(function() {
				if(direction){
	    			degree-=0.5; rotate();
				} else {
					degree+=0.5; rotate();
				}
			},1/120);
	    }
	    function shoot(multiplicador){
	    	var shootdiv = document.createElement('div');
	    	shootdiv.id = id;
	    	shootdiv.className = 'tiro';
	    	document.getElementsByTagName('body')[0].appendChild(shootdiv);
	    	$divshoot = $("#"+id);
	    	id ++;
	    	$divshoot.css({ WebkitTransform: 'rotate(' + degree + 'deg)'});
	    	x = Math.cos(degree*Math.PI/180);
	    	y = Math.sin(degree*Math.PI/180);
	    	var speed = { x: x*500, y: y*500 };
	    	var pos = { x: $earth.position().left+80*Math.cos(degree*Math.PI/180), y: $earth.position().top+80*Math.sin(degree*Math.PI/180) };
	    	//var pos = { x: $earth.position().left, y: $earth.position().top };
	    	tiro = new ElasticBody($divshoot, pos, speed, 50, 5, multiplicador);
	    	tiro.hitpolygon.angle = degree;
	    	shoots.push(tiro);
	    	if ( shoots.length > 10 ) {
	    		shoots.shift();
	    	}
	    	if (id > 10 && document.getElementById(String(id-10))) {
	    		document.getElementById(String(id-10)).remove();
	    	}
	    }

	    $(document).ready(start)
	</script>
</html>
