<html>
	<head>
		<meta charset="UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js">
		</script>
		<script src="js/jogo.js"></script>
		<script src="js/SAT.js"></script>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<body bgcolor="#000000">
		<div class="stars"></div>
		<div class="twinkling"></div>
		<h3 class="titulo">Aperte espaço para mudar a direção</h3><br>
		<h3 class="titulo">e enter para atirar</h3>
		<div class="terradiv">
			<img id="terra" src="./Earth-Free-Download-PNG.png"/>
		</div> 
		<div class="image1">
			<img id="eric" src="https://emoji.slack-edge.com/T0NGK4FPS/eric/8a5698b1bd5ce9be.png"/>
		</div> 
	</body>

	<script>
		window.addEventListener("keydown", change, false);
		window.addEventListener("keyup", shootdetector, false);
	    var $elie = $('.image1');
	    var $earth = $('.terradiv');
	    var degree = 0;
	    var degree2 = 0;
	    var direction = true;
	    var shoots = [];
	    var id = 1;
	    var salesid = "s1";
	    var salesnum = 1;
	    var salesvetor = [];

	    earthBody = new ElasticBody($earth, pos = {x:$earth.position().left,y:$earth.position().top}, {x:0,y:0}, 50, 50, 100000000);
	    salesvetor.push(earthBody);

	    function change(e){
	    	if(e.keyCode == '32'){
	    		direction = !direction;
	    	}
	    }
	    function shootdetector(e){
	    	if (e.keyCode == '13'){
	    		shoot();
	    	}
	    }
	    function rotateearth(){
	    	if (degree2 == 360 || degree2 == -360){
	    		degree2 = 0;
	    	}
	    	$earth.css({ WebkitTransform: 'rotate(' + degree2 + 'deg)'});
	    	timer = setTimeout(function() {
	    		degree2 += 0.005;
	    		for (i=0; i<shoots.length; i++){
	    			for (j=0; j<salesvetor.length; j++){
	    				if (shoots[i].contact(salesvetor[j])){
	    					shoots[i].collide(salesvetor[j]);
	    				}
	    				salesvetor[j].move(1/60);
	    				salesvetor[j].updateUI();
	    			}
		    		shoots[i].move(1/60);
		    		shoots[i].updateUI();
	    		}
	    		rotateearth();
	    	},(1/60));
	    }
	    function rotate(){
	    	if (degree == 360 || degree == -360){
	    		degree = 0;
	    	}
	    	if (degree < 0){
	    		degree = 360 + degree;
	    	}
	       	$elie.css({ WebkitTransform: 'rotate(' + degree + 'deg)'});
			timer = setTimeout(function() {
				if(direction){
	    			--degree; rotate();
				} else {
					++degree; rotate();
				}
			},1/120);
	    }
	    function shoot(){
	    	var shootdiv = document.createElement('div');
	    	shootdiv.id = id;
	    	shootdiv.className = 'tiro';
	    	document.getElementsByTagName('body')[0].appendChild(shootdiv);
	    	$divshoot = $("#"+id);
	    	id ++;
	    	$divshoot.css({ WebkitTransform: 'rotate(' + degree + 'deg)'});
	    	x = Math.cos(degree*Math.PI/180);
	    	y = Math.sin(degree*Math.PI/180);
	    	var speed = { x: x*500, y: y*500 };
	    	var pos = { x: $earth.position().left+80*Math.cos(degree*Math.PI/180), y: $earth.position().top+80*Math.sin(degree*Math.PI/180) };
	    	//var pos = { x: $earth.position().left, y: $earth.position().top };
	    	tiro = new ElasticBody($divshoot, pos, speed, 50, 5, 1);
	    	tiro.hitpolygon.angle = degree;
	    	shoots.push(tiro);
	    	if ( shoots.length > 10 ) {
	    		shoots.shift();
	    	}
	    	if (id > 10) {
	    		document.getElementById(String(id-10)).remove();
	    	}
	    }
	    function geradorDeSales(){
	    	var salesdiv = document.createElement('div');
	    	salesdiv.id = salesid;
	    	salesdiv.className = 'sales';
	    	document.getElementsByTagName('body')[0].appendChild(salesdiv);
	    	$divsales = $("#"+salesid);
	    	salesid = "s"+salesnum;
	    	$divsales.css({"top":"300", "left":"300"});
	    	sales = new ElasticBody($divsales, pos = {x:300,y:300}, {x:0,y:0}, 50, 50, 1000);
	    	salesvetor.push(sales);
	    }
	    geradorDeSales();
	    rotate();
	    rotateearth();
	</script>
</html>
